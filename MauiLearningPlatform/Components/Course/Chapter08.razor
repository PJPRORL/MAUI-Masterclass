@namespace MauiLearningPlatform.Components.Course

<div class="prose max-w-none p-6">
<h1 id="dapper-select" tabindex="-1"><a class="header-anchor" href="#dapper-select" aria-hidden="true">#</a> Dapper select</h1><h2 id="wat-is-dapper" tabindex="-1"><a class="header-anchor" href="#wat-is-dapper" aria-hidden="true">#</a> Wat is Dapper?</h2><p>Dapper is een eenvoudige object mapping tool voor .Net en .NET Core en wordt gebruikt om gegevens uit een database te bevragen. Het is even snel als de klassieke ADO .NET data reader. Het breidt de IDbConnection uit door een aantal extensie methodes toe te voegen.</p><h2 id="verschil-met-ado-net" tabindex="-1"><a class="header-anchor" href="#verschil-met-ado-net" aria-hidden="true">#</a> Verschil met ADO .NET</h2><p>In ADO.NET zou een SQL statement er als volgt uitzien:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from products&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> products <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>_connectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> reader <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Product</span>
            <span class="token punctuation">{</span>
                Id <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetInt32</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Name <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                SupplierId <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetInt32</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;SupplierId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                CategoryId <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetInt32</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;CategoryId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                QuantityPerUnit <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;QuantityPerUnit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                UnitPrice <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetDecimal</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;UnitPrice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                UnitsInStock <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetInt16</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;UnitsInStock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                UnitsOnOrder <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetInt16</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;UnitsOnOrder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ReorderLevel <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetInt16</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;ReorderLevel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Discontinued <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetBoolean</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">GetOrdinal</span><span class="token punctuation">(</span><span class="token string">&quot;Discontinued&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            products<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In Dapper kunnen we dit vereenvoudigen tot:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from products&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> products <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="orm" tabindex="-1"><a class="header-anchor" href="#orm" aria-hidden="true">#</a> ORM</h2><p>Een ORM (object relational mapper) is verantwoordelijk voor de mapping van de data tussen database en het programma. Een ORM herkent de structuur van een tabel in een database en kan deze omzetten naar een klasse(model) in C# en omgekeerd. Dapper behoort tot de familie van micro-ORM. Het concentreert zich op het uitvoeren van queries en het mappen van de resultaten naar objecten. Het is een lichtgewicht ORM en is daarom ook snel.</p><h2 id="zelf-aan-de-slag" tabindex="-1"><a class="header-anchor" href="#zelf-aan-de-slag" aria-hidden="true">#</a> Zelf aan de slag</h2><h3 id="voorbeeld-downloaden" tabindex="-1"><a class="header-anchor" href="#voorbeeld-downloaden" aria-hidden="true">#</a> Voorbeeld downloaden</h3><p><a href="https://gitpub.sebastiaanh.com/public/web/f649498a-d276-4c45-aab5-ff2757918b22" target="_blank" rel="noopener noreferrer">Download het voorbeeld van GitPub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> indien je dit nog niet gedaan hebt.</p><h3 id="database-aanmaken" tabindex="-1"><a class="header-anchor" href="#database-aanmaken" aria-hidden="true">#</a> Database aanmaken</h3><p>Voor de voorbeelden en de oefeningen op dit onderdeel hebben we een SQL-database nodig. Met behulp van onderstaande scripts kun je twee databases, inclusief tabellen en data, aanmaken. Orders wordt gebruikt in de lessen, Publishers in de oefeningen. Je kan deze sql scripts <a href="https://gitpub.sebastiaanh.com/public/web/c495fcd0-bc2c-46bc-9314-128ac8ded977" target="_blank" rel="noopener noreferrer">hier downloaden<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h3 id="voorbeeld-orders" tabindex="-1"><a class="header-anchor" href="#voorbeeld-orders" aria-hidden="true">#</a> Voorbeeld Orders</h3><p>Open het project <code>Orders</code>. Dit project is opgesteld volgens het MVVM-principe en bevat herkenbare elementen uit de vorige lessen:</p><ul><li><strong>Models</strong> (Klant, Orders, Orderlijn, Product en Werknemer). De namen van deze classes verschillen van de namen in de SQL-database maar de propertynamen moeten overeenkomen met de velden uit de database! Dit is echter niet hoofdlettergevoelig. Hou je dus aan de naamgeving voor klassen.</li><li><strong>Views</strong> (MainPage, OrdersPage en WerknemersPage)</li><li><strong>ViewModels</strong> (BaseViewModel, OrdersViewModel en WerknemersViewModel)</li><li>Een aangepast menu in <strong>AppShell.xaml</strong> en registratie van de views en ViewModels in <strong>MauiProgram.cs</strong></li></ul><p>We hebben in les 3 een <code>WerknemerRepository</code> aangemaakt met een hard-coded lijst van werknemers. In deze les gaan we terug werken met Repositories maar dan halen we de gegevens op uit de database. De repositories bevatten dan geen gegevens meer, maar methoden om gegevens op te halen. De eerste stap is de databaseverbinding instellen in het project.</p><h3 id="app-config-toevoegen" tabindex="-1"><a class="header-anchor" href="#app-config-toevoegen" aria-hidden="true">#</a> App.config toevoegen</h3><p>In de root van het project is App.config toegevoegd. Hierin bewaren we de connectionstring die zal gebruikt worden om de database te benaderen. Je doet dit door een <code>Application Configuration File</code> toe te voegen aan je project (rechtskllik -&gt; add new item). In de <code>App.config</code> zit volgende code:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token operator">&lt;</span><span class="token punctuation">?</span><span class="token class-name">xml</span> version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span> <span class="token punctuation">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>connectionStrings<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">add</span> name<span class="token operator">=</span><span class="token string">&quot;OrdersConnectionString&quot;</span> connectionString<span class="token operator">=</span><span class="token string">&quot;Server=(localdb)\MSSQLLocalDB;Database=Orders;Integrated Security=True;&quot;</span> providerName<span class="token operator">=</span><span class="token string">&quot;System.Data.SqlClient&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>connectionStrings<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>De naam is belangrijk, aangezien we deze later in ons project moeten gebruiken om te verwijzen naar deze connectie.</p><h3 id="nuget-packages-toevoegen" tabindex="-1"><a class="header-anchor" href="#nuget-packages-toevoegen" aria-hidden="true">#</a> Nuget packages toevoegen</h3><p>Om Dapper te kunnen gebruiken, heb je volgende Nuget-packages nodig. Rechtsklik op het project -&gt; Manage Nuget Packages. Zoek naar volgende packages en voeg ze toe:</p><ul><li><strong>Dapper</strong></li><li><strong>Microsoft.Data.SqlClient</strong> (omdat we een SQL-database gebruiken. Je kunt ook een andere database gebruiken zoals MongoDb of MySQL maar dan moet je een andere client installeren)</li><li><strong>System.Configuration.ConfigurationManager</strong> (Om App.Config uit te lezen)</li></ul><h3 id="project-klaarmaken-voor-het-gebruik-van-dapper" tabindex="-1"><a class="header-anchor" href="#project-klaarmaken-voor-het-gebruik-van-dapper" aria-hidden="true">#</a> Project klaarmaken voor het gebruik van Dapper</h3><p>Alle data-gerelateerde zaken plaatsen we in een map <code>Data</code>. Hierin zitten de repositories en een klasse <code>DatabaseConnection</code> met volgende code:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Orders</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseConnection</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Connectionstring</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>De ConfigurationManager zoekt in de app.config naar de connection string met de naam die je meegeeft. Deze connection string wordt dan teruggegeven.</p><p>In de map <code>Data</code> zit een basisklasse <code>BaseRepository</code> voor toekomstige repositories. Deze klasse zal de connectie met de database beheren.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">Orders</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseRepository</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ConnectionString <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">BaseRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ConnectionString <span class="token operator">=</span> DatabaseConnection<span class="token punctuation">.</span><span class="token function">Connectionstring</span><span class="token punctuation">(</span><span class="token string">&quot;OrdersConnectionString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="repositories-aanmaken" tabindex="-1"><a class="header-anchor" href="#repositories-aanmaken" aria-hidden="true">#</a> Repositories aanmaken</h3><p>We hebben een view WerknemersPage en hierop zitten een aantal knoppen die volgende methodes oproepen:</p><ul><li>OphalenWerknemers</li><li>OphalenWerknemersViaFunctie</li><li>OphalenWerknemersViaAchternaamEnVoornaam</li><li>OphalenWerknemerViaPK</li></ul><h4 id="interface-ixxxrepository-aanmaken" tabindex="-1"><a class="header-anchor" href="#interface-ixxxrepository-aanmaken" aria-hidden="true">#</a> Interface IxxxRepository aanmaken</h4><p>Voor elke repository is eerst een interface aangemaakt. In het voorbeeld hebben we, in de map <code>Data/Repository</code>, een interface <code>IWerknemerRepository</code> en een interface <code>IOrderRepository</code>. In deze IRepositories zitten de definities voor elke methode. Voor elke tabel die je wil aanspreken, maak je dus nog interface aan.</p><h4 id="klasse-xxxrespository-aanmaken" tabindex="-1"><a class="header-anchor" href="#klasse-xxxrespository-aanmaken" aria-hidden="true">#</a> Klasse xxxRespository aanmaken</h4><p>Voor elke klasse is ook een repository voorzien. We nemen een klasse <code>WerknemerRepository</code> in de map <code>Data/Repository</code> als voorbeeld waarin de interface implementeert is. In de repository zit de code voor elke methode aan de hand van volgende stappen:</p><ul><li>Schrijf een SQL statement voor de gewenste actie. Eventueel met parameters.</li><li>CreÃ«er een connectie met de database.</li><li>Geef het SQL statement door aan de Query methode van Dapper. Geef eventueel de parameters mee.</li></ul><p>Bijvoorbeeld:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span> <span class="token function">OphalenWerknemers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">&#64;&quot;SELECT * FROM werknemers ORDER BY Achternaam, Voornaam&quot;</span><span class="token punctuation">;</span> <span class="token comment">// SQL statement</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">IDbConnection</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Connectie met de database</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Query uitvoeren</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>De repository is nu klaar voor gebruik en kan gebruikt worden in de ViewModels.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">WerknemersViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">BaseViewModel</span></span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>

    <span class="token keyword">public</span> <span class="token function">WerknemersViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _werknemerRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WerknemerRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RelayCommand</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AlleWerknemersOphalen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        IsBusy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        Werknemers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ObservableCollection<span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>_werknemerRepository<span class="token punctuation">.</span><span class="token function">OphalenWerknemers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        IsBusy <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="extra-info-voor-het-gebruik-van-dapper" tabindex="-1"><a class="header-anchor" href="#extra-info-voor-het-gebruik-van-dapper" aria-hidden="true">#</a> Extra info voor het gebruik van Dapper</h4><p>Sorteren op een veld:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">&#64;&quot;SELECT * FROM werknemers ORDER BY Achternaam, Voornaam&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="query-met-1-parameter" tabindex="-1"><a class="header-anchor" href="#query-met-1-parameter" aria-hidden="true">#</a> Query met 1 parameter:</h5><p>Maak een lijst met parameters en stel de parameter in met de correcte waarde. Let op de <code>&#64;</code> voor de parameter.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ICollection<span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span> <span class="token function">OphalenWerknemersViaFunctie</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> functie<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">&#64;&quot;SELECT * FROM werknemers WHERE Functie like &#39;%&#39; + &#64;functie + &#39;%&#39; ORDER BY Achternaam, Voornaam&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> &#64;functie <span class="token operator">=</span> functie <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">IDbConnection</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="query-met-meerdere-parameters" tabindex="-1"><a class="header-anchor" href="#query-met-meerdere-parameters" aria-hidden="true">#</a> Query met meerdere parameters:</h5><p>In de parameterlijst worden alle parameters gescheiden door een komma. De volgorde van de parameters is niet belangrijk. De namen van de parameters moeten wel overeenkomen met de namen die je gebruikt in je SQL statement.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span> <span class="token function">OphalenWerknemersViaAchternaamEnVoornaam</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> achternaam<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> voornaam<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">&#64;&quot;SELECT *&quot;</span><span class="token punctuation">;</span>
    sql <span class="token operator">+=</span> <span class="token string">&quot; FROM werknemers&quot;</span><span class="token punctuation">;</span>
    sql <span class="token operator">+=</span> <span class="token string">&quot; WHERE achternaam like &#39;%&#39;+ &#64;achternaam +&#39;%&#39;&quot;</span><span class="token punctuation">;</span>
    sql <span class="token operator">+=</span> <span class="token string">&quot; AND voornaam like &#39;%&#39;+ &#64;voornaam + &#39;%&#39;&quot;</span><span class="token punctuation">;</span>
    sql <span class="token operator">+=</span> <span class="token string">&quot; ORDER BY Achternaam, Voornaam&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> &#64;voornaam <span class="token operator">=</span> voornaam<span class="token punctuation">,</span> &#64;achternaam <span class="token operator">=</span> achternaam <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">IDbConnection</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="query-die-maximaaal-1-record-teruggeeft" tabindex="-1"><a class="header-anchor" href="#query-die-maximaaal-1-record-teruggeeft" aria-hidden="true">#</a> Query die maximaaal 1 record teruggeeft:</h5><p><code>QuerySingleOrDefault</code> geeft een enkel record terug. Indien er geen record gevonden wordt, wordt er <code>null</code> teruggegeven. Indien er meerdere records gevonden worden, wordt er een exception gegooid.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">Werknemer</span> <span class="token function">OphalenWerknemerViaPK</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> werknemerID<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">&#64;&quot;SELECT *&quot;</span><span class="token punctuation">;</span>
    sql <span class="token operator">+=</span> <span class="token string">&quot; FROM werknemers&quot;</span><span class="token punctuation">;</span>
    sql <span class="token operator">+=</span> <span class="token string">&quot; WHERE Id = &#64;id&quot;</span><span class="token punctuation">;</span>
    sql <span class="token operator">+=</span> <span class="token string">&quot; ORDER BY Achternaam, Voornaam&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> &#64;id <span class="token operator">=</span> werknemerID <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">IDbConnection</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">QuerySingleOrDefault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Werknemer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bronnen en meer info:</p><ul><li><a href="https://www.learndapper.com/" target="_blank" rel="noopener noreferrer">LearnDapper<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://dappertutorial.net/" target="_blank" rel="noopener noreferrer">Dapper<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul>
</div>
